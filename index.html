<!-- ... (todo o resto do seu HTML permanece igual) -->

<table id="tabela" class="display nowrap" style="width:100%">
  <thead><tr id="cabecalho"></tr></thead>
  <tbody id="corpo"></tbody>
</table>

<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycbxw1EnlhIP5om52_kd7pns-fHfwTa_5eJr9bVWPXNfyRLTeQAAgvwPJHXAOeufIcP5d/exec';

  // Fun√ß√£o para salvar anota√ß√£o no localStorage
  function salvarAnotacao(id, texto) {
    localStorage.setItem(`anotacao_${id}`, texto);
  }

  // Fun√ß√£o para recuperar anota√ß√£o do localStorage
  function recuperarAnotacao(id) {
    return localStorage.getItem(`anotacao_${id}`) || '';
  }

  function buscar() {
    const minVolume = document.getElementById('minVolume').value || 0;
    const minCap = document.getElementById('minCap').value || 0;
    const minVar = document.getElementById('minVar').value || 0;

    const url = `${API_URL}?minVolume=${minVolume}&minCap=${minCap}&minVarPercent=${minVar}`;
    document.getElementById('status').innerText = 'üîÑ Buscando dados...';

    fetch(url)
      .then(res => res.json())
      .then(json => {
        const dados = json.dados;
        const variacaoBTC = json.variacaoBTC ?? 0;

        const btcSpan = document.getElementById('btc-valor');
        if (btcSpan) {
          const simbolo = variacaoBTC >= 0 ? 'üìà' : 'üìâ';
          btcSpan.innerText = `${simbolo} ${variacaoBTC.toFixed(2)}%`;
        }

        if (!dados || dados.length === 0) {
          document.getElementById('status').innerText = '‚ö†Ô∏è Nenhum resultado encontrado.';
          if ($.fn.DataTable.isDataTable('#tabela')) {
            $('#tabela').DataTable().clear().draw();
          }
          return;
        }

        if ($.fn.DataTable.isDataTable('#tabela')) {
          $('#tabela').DataTable().destroy();
        }

        const cabecalho = document.getElementById('cabecalho');
        const corpo = document.getElementById('corpo');
        cabecalho.innerHTML = '';
        corpo.innerHTML = '';

        // Adiciona a coluna "Anota√ß√µes"
        const colunas = Object.keys(dados[0]);
        colunas.push('Anota√ß√µes');

        // Cabe√ßalho
        colunas.forEach(col => {
          const th = document.createElement('th');
          th.innerText = col;
          cabecalho.appendChild(th);
        });

        // Corpo da tabela
        let linhasHTML = '';
        dados.forEach(linha => {
          let linhaHTML = '<tr>';

          colunas.forEach(col => {
            if (col === 'Anota√ß√µes') {
              // Identificador √∫nico para salvar anota√ß√µes, assumindo que a coluna "Symbol" existe
              const id = linha.Symbol || linha.id || JSON.stringify(linha);
              const anotacao = recuperarAnotacao(id);
              linhaHTML += `<td><textarea rows="2" style="width: 100%;" data-id="${id}" placeholder="Escreva sua anota√ß√£o aqui...">${anotacao}</textarea></td>`;
            } else {
              const valor = linha[col];
              if (typeof valor === 'string' && valor.startsWith('http')) {
                linhaHTML += `<td><a href="${valor}" target="_blank" style="color:#0066cc">üîó Link</a></td>`;
              } else {
                linhaHTML += `<td>${valor}</td>`;
              }
            }
          });

          linhaHTML += '</tr>';
          linhasHTML += linhaHTML;
        });

        corpo.innerHTML = linhasHTML;

        // Adiciona listener para salvar anota√ß√µes
        document.querySelectorAll('textarea[data-id]').forEach(textarea => {
          textarea.addEventListener('input', e => {
            const id = e.target.getAttribute('data-id');
            salvarAnotacao(id, e.target.value);
          });
        });

        $('#tabela').DataTable({
          destroy: true,
          paging: false,
          dom: 'Bfrtip',
          buttons: ['copy', 'csv'],
          language: {
            search: "üîç Buscar s√≠mbolo:",
            zeroRecords: "Nada encontrado",
            info: "",
            infoEmpty: "",
            infoFiltered: ""
          }
        });

        document.getElementById('status').innerText = `‚úÖ ${dados.length} criptomoedas encontradas.`;
      })
      .catch(err => {
        console.error(err);
        document.getElementById('status').innerText = '‚ùå Erro ao buscar os dados.';
      });
  }

  window.onload = buscar;
            </script>
